logGA=(...e)=>{},logEXT=(...e)=>{},Module.register("MMM-GoogleAssistant",{requiresVersion:"2.15.0",defaults:{debug:!1,assistantConfig:{lang:"en-US",latitude:51.50853,longitude:-.076132},responseConfig:{useFullscreen:!1,useResponseOutput:!0,responseOutputCSS:"response_output.css",screenOutputTimer:5e3,useAudioOutput:!0,useChime:!0,confirmationChime:!0,useInformations:!0,chimes:{beep:"beep.mp3",error:"error.mp3",continue:"continue.mp3",confirmation:"confirmation.mp3",open:"Google_beep_open.mp3",close:"Google_beep_close.mp3",warning:"warning.ogg"},imgStatus:{hook:"hook.gif",standby:"standby.gif",reply:"reply.gif",error:"error.gif",think:"think.gif",continue:"continue.gif",listen:"listen.gif",confirmation:"confirmation.gif",information:"information.gif",warning:"warning.gif",userError:"userError.gif"},zoom:{transcription:"80%",responseOutput:"60%"}},Extented:{stopCommand:"stop",deviceName:"MagicMirror",youtube:{useYoutube:!1,youtubeCommand:"youtube",displayResponse:!0,useVLC:!1,minVolume:30,maxVolume:100,username:null,token:null},links:{useLinks:!1,displayDelay:6e4,scrollActivate:!1,scrollStep:25,scrollInterval:1e3,scrollStart:5e3},photos:{usePhotos:!1,useGooglePhotosAPI:!1,displayType:"none",displayDelay:1e4,albums:[],sort:"new",hiResolution:!0,timeFormat:"DD/MM/YYYY HH:mm",moduleHeight:300,moduleWidth:300},volume:{useVolume:!1,volumePreset:"PULSE",myScript:null},welcome:{useWelcome:!1,welcome:"brief Today"},screen:{useScreen:!1,animateBody:!0,animateTime:3e3,delay:3e5,turnOffDisplay:!0,mode:1,ecoMode:!0,delayed:0,displayCounter:!0,displayBar:!0,displayStyle:"Text",detectorSleeping:!1,governorSleeping:!1,displayLastPresence:!0,userPresenceNotification:!0,screenStatusNotification:!0},touch:{useTouch:!0,mode:2},pir:{usePir:!1,gpio:21,reverseValue:!1},governor:{useGovernor:!1,useCallback:!0,sleeping:"powersave",working:"ondemand"},internet:{useInternet:!1,displayPing:!1,delay:12e4,scan:"google.fr",command:"pm2 restart 0",showAlert:!0,needRestart:!1,language:config.language},cast:{useCast:!1,port:8569},spotify:{useSpotify:!1,visual:{updateInterval:1e3,idleInterval:1e4,useBottomBar:!1,PATH:"../../../tokens/",TOKEN:"tokenSpotify.json",CLIENT_ID:"",CLIENT_SECRET:""},player:{type:"none",email:"",password:"",minVolume:10,maxVolume:90,usePause:!0}},music:{useMusic:!1,useUSB:!1,musicPath:"/home/pi/Music",checkSubDirectory:!1,autoStart:!1,minVolume:30,maxVolume:100}},recipes:[],NPMCheck:{useChecker:!0,delay:6e5,useAlert:!0}},micConfig:{recorder:"auto",device:"default"},plugins:{onReady:[],onNotificationReceived:[],onActivate:[],onStatus:[]},commands:{},transcriptionHooks:{},responseHooks:{},forceResponse:!1,getScripts:function(){return["/modules/MMM-GoogleAssistant/components/response.js","/modules/MMM-GoogleAssistant/components/extented.js","/modules/MMM-GoogleAssistant/components/progressbar.js","/modules/MMM-GoogleAssistant/components/spotify.js","/modules/MMM-GoogleAssistant/components/musicplayer.js","https://cdn.materialdesignicons.com/5.2.45/css/materialdesignicons.min.css","https://code.iconify.design/1/1.0.6/iconify.min.js","/modules/MMM-GoogleAssistant/components/long-press-event.js"]},getStyles:function(){return["/modules/MMM-GoogleAssistant/MMM-GoogleAssistant.css","font-awesome.css","https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"]},getTranslations:function(){return{en:"translations/en.json",fr:"translations/fr.json",it:"translations/it.json",de:"translations/de.json",es:"translations/es.json",nl:"translations/nl.json",pt:"translations/pt.json",ko:"translations/ko.json"}},start:function(){this.init=!1,this.aliveTimer=null,this.userPresence=null,this.lastPresence=null,this.Infos={displayed:!1,buffer:[]};const e=["debug","recipes","assistantConfig","responseConfig","Extented","NPMCheck"];this.helperConfig={},this.helperConfig.micConfig=this.micConfig,this.config.debug&&(logGA=(...e)=>{console.log("[GA]",...e)},logEXT=(...e)=>{console.log("[GA:EXT]",...e)});for(var t=0;t<e.length;t++)this.helperConfig[e[t]]=this.config[e[t]];this.myStatus={actual:"standby",old:"standby"};var s={assistantActivate:e=>{this.assistantActivate(e)},postProcess:(e,t,s)=>{this.postProcess(e,t,s)},endResponse:()=>{this.endResponse()},translate:e=>this.translate(e),myStatus:e=>{this.doPlugin("onStatus",{status:e}),this.myStatus=e,this.sendNotification("ASSISTANT_"+this.myStatus.actual.toUpperCase()),this.EXTActionsOnStatus(this.myStatus.actual)},EXT:e=>this.ExtentedDisplay(e),sendSocketNotification:(e,t)=>{this.sendSocketNotification(e,t)},radioStop:()=>this.displayEXTResponse.radio.pause(),spotifyStatus:e=>{if(e)this.EXT.spotify.connected=!0;else{if(this.EXT.spotify.connected=!1,this.EXT.spotify.player&&this.config.Extented.screen.useScreen&&!this.displayEXTResponse.working()){if(this.EXT.radioPlayer.play)return;this.sendSocketNotification("SCREEN_LOCK",!1),this.displayEXTResponse.showDivWithAnimatedFlip("EXT_SCREEN_CONTENER")}this.EXT.spotify.player=!1}},YTError:e=>this.Informations("warning",{message:e}),Informations:e=>this.Informations("information",e),Warning:e=>this.Informations("warning",e)};this.assistantResponse=new AssistantResponse(this.helperConfig.responseConfig,s),this.checkStyle(),this.spotifyNewVolume=!1,this.userPresence=null,this.lastPresence=null,this.DateTranslate={day:" "+this.translate("DAY")+" ",days:" "+this.translate("DAYS")+" ",hour:" "+this.translate("HOUR")+" ",hours:" "+this.translate("HOURS")+" ",minute:" "+this.translate("MINUTE")+" ",minutes:" "+this.translate("MINUTES")+" ",second:" "+this.translate("SECOND"),seconds:" "+this.translate("SECONDS")};var i={transcriptionHooks:{EXT_Stop:{pattern:this.config.Extented.stopCommand,command:"EXT_Stop"}},commands:{EXT_Stop:{moduleExec:{module:["MMM-GoogleAssistant"],exec:"__FUNC__(module) => { module.stopCommand() }"},soundExec:{chime:"close"},displayResponse:!1}}};if(this.parseLoadedRecipe(JSON.stringify(i)),this.config.Extented.youtube.useYoutube){var o={transcriptionHooks:{SEARCH_YouTube:{pattern:this.config.Extented.youtube.youtubeCommand+" (.*)",command:"GA_youtube"}},commands:{GA_youtube:{moduleExec:{module:["MMM-GoogleAssistant"],exec:"__FUNC__(module, params) => { module.sendSocketNotification('YouTube_SEARCH', params[1]) }"},soundExec:{chime:"open"},displayResponse:this.config.Extented.youtube.displayResponse}}};this.parseLoadedRecipe(JSON.stringify(o))}this.config.Extented.volume.volumeText=this.translate("VolumeText"),this.config.Extented.spotify.visual.deviceDisplay=this.translate("SpotifyListenText"),this.config.Extented.spotify.visual.SpotifyForGA=this.translate("SpotifyForGA"),this.config.Extented.photos.LoadingText=this.translate("LOADING"),this.config.Extented.photos.GPAlbumName=this.translate("GPAlbumName"),this.displayEXTResponse=new Extented(this.config.Extented,s),this.config.Extented.spotify.useSpotify&&(this.spotify=new Spotify(this.config.Extented.spotify.visual,s,this.config.debug)),this.config.Extented.music.useMusic&&(this.Music=new Music(this.config.Extented.music,s,this.config.debug)),this.EXT=this.displayEXTResponse.EXT,this.config.Extented.youtube.useYoutube&&this.config.Extented.youtube.useVLC&&this.initializeVolumeVLC(),this.config.Extented.music.useMusic&&this.initializeMusicVolumeVLC()},doPlugin:function(e,t){if(this.plugins.hasOwnProperty(e)){var s=this.plugins[e];if(Array.isArray(s)&&s.length>0)for(var i=0;i<s.length;i++){var o=s[i];this.doCommand(o,t,e)}}},registerPluginsObject:function(e){for(var t in this.plugins)if(e.hasOwnProperty(t)){var s=[];Array.isArray(e[t])?s=s.concat(e[t]):s.push(e[t].toString());for(var i=0;i<s.length;i++)this.registerPlugin(t,s[i])}},registerPlugin:function(e,t){this.plugins.hasOwnProperty(e)&&(Array.isArray(t)&&this.plugins[e].concat(t),this.plugins[e].push(t))},registerCommandsObject:function(e){this.commands=Object.assign({},this.commands,e)},registerTranscriptionHooksObject:function(e){this.transcriptionHooks=Object.assign({},this.transcriptionHooks,e)},registerResponseHooksObject:function(e){this.responseHooks=Object.assign({},this.responseHooks,e)},getDom:function(){var e=document.createElement("div");if(e.id="EXT_DISPLAY",this.config.Extented.spotify.useSpotify&&!this.config.Extented.spotify.visual.useBottomBar&&(spotify=this.spotify.prepareMini(),e.appendChild(spotify)),this.config.Extented.music.useMusic&&(music=this.Music.prepare(),e.appendChild(music)),this.config.Extented.photos.usePhotos&&this.config.Extented.photos.useGooglePhotosAPI&&"Module"==this.config.Extented.photos.displayType){var t=document.createElement("div");t.id="EXT_GPHOTO",t.style.height=this.config.Extented.photos.moduleHeight+"px",t.style.width=this.config.Extented.photos.moduleWidth+"px";var s=document.createElement("div");s.id="EXT_GPHOTO_BACK";var i=document.createElement("div");i.id="EXT_GPHOTO_CURRENT",i.addEventListener("animationend",(()=>{i.classList.remove("animated")}));var o=document.createElement("div");o.id="EXT_GPHOTO_INFO",o.className="Module",o.innerHTML="Extented GPhotos Loading...",t.appendChild(s),t.appendChild(i),t.appendChild(o),e.appendChild(t)}var n=document.createElement("div");n.id="EXT_SCREEN_CONTENER",n.className="animate__animated",n.style.setProperty("--animate-duration","1s");var a=document.createElement("div");a.id="EXT_SCREEN",this.config.Extented.screen.useScreen&&"Text"==this.config.Extented.screen.displayStyle||(a.className="hidden");var r=document.createElement("div");r.id="EXT_SCREEN_TEXT",r.textContent=this.translate("ScreenTurnOff"),a.appendChild(r);var c=document.createElement("div");c.id="EXT_SCREEN_COUNTER",c.classList.add("counter"),c.textContent="--:--",a.appendChild(c),n.appendChild(a);var d=document.createElement("div");d.id="EXT_BAR",this.config.Extented.screen.useScreen&&"Text"!=this.config.Extented.screen.displayStyle&&this.config.Extented.screen.displayBar||(d.className="hidden");var l=document.createElement("div");l.id="EXT_SCREEN_BAR",l.classList.add(this.config.Extented.screen.displayStyle),d.appendChild(l),n.appendChild(d);var h=document.createElement("div");h.id="EXT_PRESENCE",h.className="hidden";var p=document.createElement("div");p.id="EXT_PRESENCE_TEXT",p.textContent=this.translate("ScreenLastPresence"),h.appendChild(p);var u=document.createElement("div");u.id="EXT_PRESENCE_DATE",u.classList.add("presence"),u.textContent="Loading ...",h.appendChild(u),n.appendChild(h);var E=document.createElement("div");E.id="EXT_INTERNET",this.config.Extented.internet.useInternet&&this.config.Extented.internet.displayPing||(E.className="hidden");var f=document.createElement("div");f.id="EXT_INTERNET_TEXT",f.textContent="Ping: ",E.appendChild(f);var m=document.createElement("div");m.id="EXT_INTERNET_PING",m.classList.add("ping"),m.textContent="Loading ...",E.appendChild(m);var T=document.createElement("div");T.id="EXT_RADIO",T.className="hidden animate__animated",T.style.setProperty("--animate-duration","1s");var y=document.createElement("div");y.id="EXT_RADIO_BACKGROUND",T.appendChild(y);var g=document.createElement("div");g.id="EXT_RADIO_FOREGROUND",T.appendChild(g);var S=document.createElement("img");return S.id="EXT_RADIO_IMG",g.appendChild(S),e.appendChild(T),e.appendChild(n),e.appendChild(E),this.assistantResponse.preparePopup(),this.assistantResponse.prepareBackground(),e},notificationReceived:function(e,t=null,s=null){switch(this.doPlugin("onNotificationReceived",{notification:e,payload:t}),e){case"DOM_OBJECTS_CREATED":this.sendSocketNotification("INIT",this.helperConfig),this.displayEXTResponse.prepare(),this.config.Extented.screen.useScreen&&("Text"!=this.config.Extented.screen.displayStyle&&this.displayEXTResponse.prepareBar(),this.config.Extented.screen.animateBody&&this.displayEXTResponse.prepareBody()),this.config.Extented.spotify.useSpotify&&this.config.Extented.spotify.visual.useBottomBar&&this.spotify.prepare(),this.config.Extented.touch.useTouch&&this.touchScreen(this.config.Extented.touch.mode),this.assistantResponse.prepareGA(),this.Loading(),!this.config.Extented.photos.usePhotos||"Background"!=this.config.Extented.photos.displayType&&"Module"!=this.config.Extented.photos.displayType||setTimeout((()=>{this.config.Extented.photos.useGooglePhotosAPI?this.displayEXTResponse.showBackgroundGooglePhotoAPI():this.Informations("warning",{message:"GPhotosNotActivated"})}),1e4);break;case"GA_ACTIVATE":this.assistantActivate({type:"MIC"});break;case"WAKEUP":this.config.Extented.screen.useScreen&&(this.sendSocketNotification("SCREEN_WAKEUP"),this.Informations("information",{message:"ScreenWakeUp",values:s.name}));break;case"EXT_LOCK":this.config.Extented.screen.useScreen&&(this.sendSocketNotification("SCREEN_LOCK",!0),this.displayEXTResponse.hideDivWithAnimatedFlip("EXT_SCREEN_CONTENER"),this.Informations("information",{message:"ScreenLock",values:s.name}));break;case"EXT_UNLOCK":this.config.Extented.screen.useScreen&&(this.sendSocketNotification("SCREEN_LOCK",!1),this.displayEXTResponse.showDivWithAnimatedFlip("EXT_SCREEN_CONTENER"),this.Informations("information",{message:"ScreenUnLock",values:s.name}));break;case"EXT_OPEN":this.ExtentedOpen(t);break;case"USER_PRESENCE":this.config.Extented.screen.useScreen&&("true"==t||1==t||1==t||"1"==t?(this.sendSocketNotification("SCREEN_WAKEUP"),this.Informations("information",{message:"ScreenWakeUp",values:s.name})):(this.sendSocketNotification("SCREEN_FORCE_END"),this.Informations("information",{message:"ScreenPowerOff"})))}},socketNotificationReceived:function(e,t){switch(this.EXT=this.displayEXTResponse.EXT,e){case"NPM_UPDATE":t&&t.length>0&&(this.config.NPMCheck.useAlert&&t.forEach((e=>{this.sendNotification("SHOW_ALERT",{type:"notification",message:"[NPM] "+e.library+" v"+e.installed+" -> v"+e.latest,title:this.translate("UPDATE_NOTIFICATION_MODULE",{MODULE_NAME:e.module}),timer:this.config.NPMCheck.delay-2e3})})),this.sendNotification("NPM_UPDATE",t));break;case"LOAD_RECIPE":this.parseLoadedRecipe(t);break;case"NOT_INITIALIZED":this.assistantResponse.fullscreen(!0),this.assistantResponse.showError(this.translate(t.message,{VALUES:t.values})),this.assistantResponse.forceStatusImg("userError");break;case"ERROR":this.Informations("warning",{message:t});break;case"WARNING":this.Informations("warning",t);break;case"INFORMATION":this.Informations("information",t);break;case"INITIALIZED":logGA("Initialized."),this.Version(t),this.assistantResponse.status("standby"),this.doPlugin("onReady"),this.sendWelcome();break;case"ASSISTANT_RESULT":null!==t.volume&&this.sendSocketNotification("VOLUME_SET",t.volume),this.assistantResponse.start(t);break;case"TUNNEL":this.assistantResponse.tunnel(t);break;case"ASSISTANT_ACTIVATE":this.assistantActivate(t);break;case"AUDIO_END":this.assistantResponse.end();break;case"YouTube_RESULT":this.sendYouTubeResult(t);break;case"SCREEN_TIMER":if("Text"==this.config.Extented.screen.displayStyle){document.getElementById("EXT_SCREEN_COUNTER").textContent=t}break;case"SCREEN_BAR":if("Text"!=this.config.Extented.screen.displayStyle){let e=(100-100*t/this.config.Extented.screen.delay)/100,s=moment(new Date(this.config.Extented.screen.delay-t)).format("mm:ss");this.displayEXTResponse.bar.animate(e,{step:(e,t)=>{t.path.setAttribute("stroke",e.color),t.setText(this.config.Extented.screen.displayCounter?s:""),t.text.style.color=e.color}})}break;case"SCREEN_PRESENCE":if(this.config.Extented.screen.userPresenceNotification&&this.sendNotification("USER_PRESENCE",!!t),t?this.lastPresence=moment().format("LL HH:mm"):this.userPresence=this.lastPresence,this.userPresence&&this.config.Extented.screen.displayLastPresence){document.getElementById("EXT_PRESENCE").classList.remove("hidden"),document.getElementById("EXT_PRESENCE_DATE").textContent=this.userPresence}break;case"SCREEN_SHOWING":this.displayEXTResponse.screenShowing();break;case"SCREEN_HIDING":this.displayEXTResponse.screenHiding();break;case"SCREEN_POWER":this.config.Extented.screen.screenStatusNotification&&(t?this.sendNotification("SCREEN_ON"):this.sendNotification("SCREEN_OFF")),t?this.Informations("information",{message:"ScreenPowerOn"}):this.Informations("information",{message:"ScreenPowerOff"});break;case"INTERNET_DOWN":1==t.ticks&&this.sendSocketNotification("SCREEN_WAKEUP");let e=moment(t.date).fromNow();this.Informations("warning",{message:"InternetDown",values:e});break;case"INTERNET_RESTART":this.sendSocketNotification("SCREEN_WAKEUP"),this.Informations("information",{message:"InternetRestart"});break;case"INTERNET_AVAILABLE":let s=t;this.sendSocketNotification("SCREEN_WAKEUP");let i=(s.day?s.day+(s.day>1?this.DateTranslate.days:this.DateTranslate.day):"")+(s.hour?s.hour+(s.hour>1?this.DateTranslate.hours:this.DateTranslate.hour):"")+(s.min?s.min+(s.min>1?this.DateTranslate.minutes:this.DateTranslate.minute):"")+s.sec+(s.sec>1?this.DateTranslate.seconds:this.DateTranslate.second);this.Informations("information",{message:"InternetAvailable",values:i});break;case"INTERNET_PING":document.getElementById("EXT_INTERNET_PING").textContent=t;break;case"CAST_START":this.sendSocketNotification("SCREEN_WAKEUP"),this.Informations("information",{message:"CastStart"}),this.displayEXTResponse.castStart(t);break;case"CAST_STOP":this.Informations("information",{message:"CastStop"}),this.displayEXTResponse.castStop();break;case"SPOTIFY_PLAY":if(this.spotify.updateCurrentSpotify(t),!this.EXT.spotify.connected)return;t&&t.device&&t.device.name&&(this.EXT.spotify.repeat=t.repeat_state,this.EXT.spotify.shuffle=t.shuffle_state,t.device.name==this.config.Extented.deviceName?(this.EXT.radioPlayer.play&&this.displayEXTResponse.radio.pause(),this.EXT.spotify.currentVolume=t.device.volume_percent,this.EXT.spotify.player||(this.EXT.spotify.player=!0),this.EXT.spotify.connected&&this.config.Extented.screen.useScreen&&!this.displayEXTResponse.working()&&(this.sendSocketNotification("SCREEN_WAKEUP"),this.sendSocketNotification("SCREEN_LOCK",!0),this.displayEXTResponse.hideDivWithAnimatedFlip("EXT_SCREEN_CONTENER"))):(this.EXT.spotify.connected&&this.EXT.spotify.player&&this.config.Extented.screen.useScreen&&!this.displayEXTResponse.working()&&(this.sendSocketNotification("SCREEN_LOCK",!1),this.displayEXTResponse.showDivWithAnimatedFlip("EXT_SCREEN_CONTENER")),this.EXT.spotify.player&&(this.EXT.spotify.player=!1)));break;case"SPOTIFY_IDLE":this.spotify.updatePlayback(!1),this.EXT.spotify.player&&this.config.Extented.screen.useScreen&&!this.displayEXTResponse.working()&&this.sendSocketNotification("SCREEN_LOCK",!1),this.EXT.spotify.player=!1;break;case"DONE_SPOTIFY_VOLUME":this.EXT.spotify.forceVolume&&this.config.Extented.spotify.useSpotify&&this.EXT.spotify.player&&(this.EXT.spotify.targetVolume=t);break;case"FINISH_YOUTUBE":this.EXT.youtube.displayed=!1,this.displayEXTResponse.showYT(),this.displayEXTResponse.EXTUnlock(),this.displayEXTResponse.resetYT();break;case"VOLUME_DONE":this.displayEXTResponse.drawVolume(t);break;case"DETECTOR_START":this.sendNotification("DETECTOR_START");break;case"DETECTOR_STOP":this.sendNotification("DETECTOR_STOP");break;case"GPhotos_PICT":t&&Array.isArray(t)&&t.length>0&&(this.EXT.GPhotos.needMorePicsFlag=!1,this.EXT.GPhotos.scanned=t,this.EXT.GPhotos.index=0,this.EXT.GPhotos.scanned=t,this.Informations("information",{message:"GPReceive",values:t.length}));break;case"GPhotos_INIT":this.EXT.GPhotos.albums=t;break;case"Music_Player":t.connected?(this.EXT.music.connected=!0,t.pause||this.Music.setPlay(),this.EXT.radioPlayer.play&&this.displayEXTResponse.radio.pause(),this.config.Extented.screen.useScreen&&!this.displayEXTResponse.working()&&(this.sendSocketNotification("SCREEN_WAKEUP"),this.sendSocketNotification("SCREEN_LOCK",!0),this.displayEXTResponse.hideDivWithAnimatedFlip("EXT_SCREEN_CONTENER"))):(this.EXT.music.connected=!1,this.config.Extented.screen.useScreen&&!this.displayEXTResponse.working()&&(this.sendSocketNotification("SCREEN_LOCK",!1),this.displayEXTResponse.showDivWithAnimatedFlip("EXT_SCREEN_CONTENER"))),this.Music.updateSongInfo(t);break;case"Music_Player_PAUSE":this.Music.setPause()}},parseLoadedRecipe:function(payload){let reviver=(key,value)=>{if("string"==typeof value&&0===value.indexOf("__FUNC__")){value=value.slice(8);let functionTemplate=`(${value})`;return eval(functionTemplate)}return value};var p=JSON.parse(payload,reviver);p.hasOwnProperty("commands")&&this.registerCommandsObject(p.commands),p.hasOwnProperty("transcriptionHooks")&&this.registerTranscriptionHooksObject(p.transcriptionHooks),p.hasOwnProperty("responseHooks")&&this.registerResponseHooksObject(p.responseHooks),p.hasOwnProperty("plugins")&&this.registerPluginsObject(p.plugins)},clearAliveTimers(){clearTimeout(this.assistantResponse.aliveTimer),this.assistantResponse.aliveTimer=null,clearTimeout(this.aliveTimer),this.aliveTimer=null},assistantActivate:function(e){if("standby"!=this.myStatus.actual&&!e.force)return logGA("Assistant is busy.");this.clearAliveTimers(),"continue"==this.myStatus.actual?this.assistantResponse.showTranscription(this.translate("GAContinue")):this.assistantResponse.showTranscription(this.translate("GABegin")),this.sendNotification("DETECTOR_STOP"),this.doPlugin("onActivate"),this.assistantResponse.fullscreen(!0),this.lastQuery=null;var t={type:"TEXT",key:null,lang:this.config.assistantConfig.lang,useResponseOutput:this.config.responseConfig.useResponseOutput,useAudioOutput:this.config.responseConfig.useAudioOutput,status:this.myStatus.old,chime:!0};t=Object.assign({},t,e);this.assistantResponse.status(t.type,!!t.chime),this.sendSocketNotification("ACTIVATE_ASSISTANT",t)},endResponse:function(){this.sendNotification("DETECTOR_START")},postProcess:function(e,t=(()=>{}),s=(()=>{})){if("continue"==e.lastQuery.status)return s();var i=this.findAllHooks(e);if(i.length>0){this.assistantResponse.status("hook");for(var o=0;o<i.length;o++){var n=i[o];this.doCommand(n.command,n.params,n.from)}this.forceResponse?(this.forceResponse=!1,s()):t()}else s()},findAllHooks:function(e){var t=[];return t=(t=t.concat(this.findTranscriptionHook(e))).concat(this.findResponseHook(e)),this.findNativeAction(e),t},findResponseHook:function(e){var t=[];if(e.screen){var s=[];for(var i in s.links=e.screen.links?e.screen.links:[],s.text=e.screen.text?[].push(e.screen.text):[],s.photos=e.screen.photos?e.screen.photos:[],this.responseHooks)if(this.responseHooks.hasOwnProperty(i)){var o=this.responseHooks[i];if(o.where&&o.pattern&&o.command){var n=new RegExp(o.pattern,"ig").exec(s[o.where]);n&&(t.push({from:i,params:n,command:o.command}),logGA("ResponseHook matched:",i))}}}return t},findTranscriptionHook:function(e){var t=[],s=e.transcription?e.transcription.transcription:"";for(var i in this.transcriptionHooks)if(this.transcriptionHooks.hasOwnProperty(i)){var o=this.transcriptionHooks[i];if(o.pattern&&o.command){var n=new RegExp(o.pattern,"ig").exec(s);n&&(t.push({from:i,params:n,command:o.command}),logGA("TranscriptionHook matched:",i))}else logGA(`TranscriptionHook:${i} has invalid format`)}return t},findNativeAction:function(e){var t=e.action?e.action:null;t&&t.inputs&&t.inputs.forEach((e=>{"action.devices.EXECUTE"==e.intent&&e.payload.commands.forEach((e=>{e.execution.forEach((e=>{logGA("Native Action: "+e.command,e.params),"action.devices.commands.SetVolume"==e.command&&this.config.Extented.volume.useVolume&&(logGA("Volume Control:",e.params.volumeLevel),this.sendSocketNotification("VOLUME_SET",e.params.volumeLevel))}))}))}))},doCommand:function(e,t,s){if(this.commands.hasOwnProperty(e)){var i=this.commands[e];i.displayResponse&&(this.forceResponse=!0);var o="object"==typeof t?Object.assign({},t):t;if(i.hasOwnProperty("notificationExec")){var n=i.notificationExec;if(n.notification){var a="function"==typeof n.notification?n.notification(o,s):n.notification,r=n.payload?"function"==typeof n.payload?n.payload(o,s):n.payload:null,c="object"==typeof r?Object.assign({},r):r;logGA(`Command ${e} is executed (notificationExec).`),this.sendNotification(a,c)}}if(i.hasOwnProperty("shellExec")){var d=i.shellExec;if(d.exec){var l="function"==typeof d.exec?d.exec(o,s):d.exec,h=d.options?"function"==typeof d.options?d.options(o,s):d.options:null,p="function"==typeof h?h(o,key):h;l&&(logGA(`Command ${e} is executed (shellExec).`),this.sendSocketNotification("SHELLEXEC",{command:l,options:p}))}}if(i.hasOwnProperty("moduleExec")){var u=i.moduleExec,E="function"==typeof u.module?u.module(o,s):u.module,f=Array.isArray(E)?E:new Array(E);"function"==typeof u.exec&&MM.getModules().enumerate((t=>{(0==f.length||f.indexOf(t.name)>=0)&&(logGA(`Command ${e} is executed (moduleExec) for :`,t.name),u.exec(t,o,s))}))}if(i.hasOwnProperty("functionExec")){var m=i.functionExec;"function"==typeof m.exec&&(logGA(`Command ${e} is executed (functionExec)`),m.exec(o,s))}if(i.hasOwnProperty("soundExec")){var T=i.soundExec;T.chime&&"string"==typeof T.chime&&("open"==T.chime&&this.assistantResponse.playChime("open"),"close"==T.chime&&this.assistantResponse.playChime("close")),T.sound&&"string"==typeof T.sound&&this.assistantResponse.playChime(T.sound,!0)}}else logGA(`Command ${e} is not found.`)},ExtentedDisplay:function(e){var t={photos:null,urls:null};e.screen&&(e.screen.links.length>0||e.screen.photos.length>0)&&(t.photos=e.screen.photos,t.urls=e.screen.links,logGA("Send Extented Display Response."),this.displayEXTResponse.start(t))},sendYouTubeResult:function(e){var t={photos:[],urls:["https://www.youtube.com/watch?v="+e]};logGA("Send YouTube Response to Extented Display."),this.displayEXTResponse.start(t)},ExtentedOpen(e){if(logGA("Received External Extented instructions",e),e&&e.urls&&e.photos){var t={photos:null,urls:null};e.urls.length>0||e.photos.length>0?(t.photos=e.photos,t.urls=e.urls,logGA("Send Extented Display Response."),this.displayEXTResponse.start(t)):logGA("[Error] External Extented instructions.")}},getCommands:function(e){e.add({command:"query",description:this.translate("QUERY_HELP"),callback:"tbQuery"}),e.add({command:"restart",description:this.translate("RESTART_HELP"),callback:"tbRestart"}),this.config.Extented.screen.useScreen&&e.add({command:"wakeup",description:this.translate("WAKEUP_HELP"),callback:"tbWakeup"}),e.add({command:"hide",description:this.translate("HIDE_HELP"),callback:"tbHide"}),e.add({command:"show",description:this.translate("SHOW_HELP"),callback:"tbShow"}),e.add({command:"stop",description:this.translate("STOP_HELP"),callback:"tbStopEXT"}),e.add({command:"EXT",description:this.translate("EXT_HELP"),callback:"tbEXT"}),this.config.Extented.volume.useVolume&&e.add({command:"volume",description:this.translate("VOLUME_HELP"),callback:"tbVolume"}),this.config.Extented.spotify.useSpotify&&e.add({command:"spotify",description:"Spotify commands",callback:"tbSpotify"}),this.config.Extented.music.useMusic&&e.add({command:"music",description:"Music player commands",callback:"tbMusic"})},tbQuery:function(e,t){var s=t.args;s?this.assistantActivate({type:"TEXT",key:s}):t.reply("TEXT",this.translate("QUERY_HELP"))},tbRestart:function(e,t){t.args?(this.sendSocketNotification("RESTART",t.args),t.reply("TEXT",this.translate("RESTART_DONE"))):t.reply("TEXT",this.translate("RESTART_ERROR"))},tbWakeup:function(e,t){this.sendSocketNotification("SCREEN_WAKEUP"),t.reply("TEXT",this.translate("WAKEUP_REPLY"))},tbHide:function(e,t){var s=!1,i=!1;return t.args?"MMM-GoogleAssistant"==t.args?t.reply("TEXT",this.translate("DADDY")):(MM.getModules().enumerate((e=>{if(e.name==t.args){if(s=!0,e.hidden)return t.reply("TEXT",t.args+this.translate("HIDE_ALREADY"));if(e.lockStrings.length>0){if(e.lockStrings.forEach((s=>{"TB_EXT"==s&&(e.hide(500,{lockString:"TB_EXT"}),0==e.lockStrings.length&&(i=!0,t.reply("TEXT",t.args+this.translate("HIDE_DONE"))))})),!i)return t.reply("TEXT",t.args+this.translate("HIDE_LOCKED"))}else e.hide(500,{lockString:"TB_EXT"}),t.reply("TEXT",t.args+this.translate("HIDE_DONE"))}})),void(s||t.reply("TEXT",this.translate("MODULE_NOTFOUND")+t.args))):t.reply("TEXT",this.translate("MODULE_NAME"))},tbShow:function(e,t){var s=!1,i=!1;if(!t.args)return t.reply("TEXT",this.translate("MODULE_NAME"));MM.getModules().enumerate((e=>{if(e.name==t.args){if(s=!0,!e.hidden)return t.reply("TEXT",t.args+this.translate("SHOW_ALREADY"));if(e.lockStrings.length>0){if(e.lockStrings.forEach((s=>{"TB_EXT"==s&&(e.show(500,{lockString:"TB_EXT"}),0==e.lockStrings.length&&(i=!0,t.reply("TEXT",t.args+this.translate("SHOW_DONE"))))})),!i)return t.reply("TEXT",t.args+this.translate("SHOW_LOCKED"))}else e.show(500,{lockString:"TB_EXT"}),t.reply("TEXT",t.args+this.translate("SHOW_DONE"))}})),s||t.reply("TEXT",this.translate("MODULE_NOTFOUND")+t.args)},tbStopEXT:function(e,t){this.stopCommand(),t.reply("TEXT",this.translate("STOP_EXT"))},tbEXT:function(e,t){if(t.args){var s={photos:[],urls:[]},i=/^((http(s)?):\/\/)(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/,o=i.test(t.args),n=i.test("http://"+t.args);o||n?(t.reply("TEXT",this.translate("EXT_OPEN")+t.args),s.urls[0]=o?t.args:"http://"+t.args,this.config.Extented.screen.useScreen&&this.sendSocketNotification("SCREEN_WAKEUP"),this.displayEXTResponse.start(s)):t.reply("TEXT",this.translate("EXT_INVALID"))}else t.reply("TEXT","/EXT <link>")},tbVolume:function(e,t){if(t.args){var s=Number(t.args);if(!s&&0!=s||s<0||s>100)return t.reply("TEXT","/volume [0-100]");this.sendSocketNotification("VOLUME_SET",s),t.reply("TEXT","Volume "+s+"%")}else t.reply("TEXT","/volume [0-100]")},tbSpotify:function(e,t){if(t.args){var s=t.args.toLowerCase().split(" "),i=t.args.split(" ");if("play"==s[0]&&(t.reply("TEXT","Spotify PLAY"),this.SpotifyCommand("PLAY")),"pause"==s[0]&&(t.reply("TEXT","Spotify PAUSE"),this.SpotifyCommand("PAUSE")),"stop"==s[0]&&(t.reply("TEXT","Spotify STOP"),this.SpotifyCommand("STOP")),"next"==s[0]&&(t.reply("TEXT","Spotify NEXT"),this.SpotifyCommand("NEXT")),"previous"==s[0]&&(t.reply("TEXT","Spotify PREVIOUS"),this.SpotifyCommand("PREVIOUS")),"volume"==s[0])if(s[1]){if(isNaN(s[1]))return t.reply("TEXT","Must be a number ! [0-100]");s[1]>100&&(s[1]=100),s[1]<0&&(s[1]=0),t.reply("TEXT","Spotify VOLUME: "+s[1]),this.SpotifyCommand("VOLUME",s[1])}else t.reply("TEXT","Define volume [0-100]");"to"==s[0]&&(s[1]?(t.reply("TEXT","Spotify TRANSFER to: "+i[1]+" (if exist !)"),this.SpotifyCommand("TRANSFER",i[1])):t.reply("TEXT","Define the device name (case sensitive)"))}else t.reply("TEXT","Need Help for /spotify commands ?\n\n  *play*: Launch music (last title)\n  *pause*: Pause music\n  *stop*: Stop music\n  *next*: Next track\n  *previous*: Previous track\n  *volume*: Volume control, it need a value 0-100\n  *to*: Transfert music to another device (case sensitive)  ",{parse_mode:"Markdown"})},tbMusic:function(e,t){if(t.args){var s=t.args.toLowerCase().split(" ");t.args.split(" ");if("play"==s[0]&&(t.reply("TEXT","Music PLAY"),this.MusicCommand("PLAY")),"pause"==s[0]&&(t.reply("TEXT","Music PAUSE"),this.MusicCommand("PAUSE")),"stop"==s[0]&&(t.reply("TEXT","Music STOP"),this.MusicCommand("STOP")),"next"==s[0]&&(t.reply("TEXT","Music NEXT"),this.MusicCommand("NEXT")),"previous"==s[0]&&(t.reply("TEXT","Music PREVIOUS"),this.MusicCommand("PREVIOUS")),"rebuild"==s[0]&&(t.reply("TEXT","Rebuild music database"),this.MusicCommand("REBUILD")),"volume"==s[0])if(s[1]){if(isNaN(s[1]))return t.reply("TEXT","Must be a number ! [0-100]");s[1]>100&&(s[1]=100),s[1]<0&&(s[1]=0),t.reply("TEXT","Music VOLUME: "+s[1]),this.MusicCommand("VOLUME",parseInt((256*s[1]/100).toFixed(0)),!0)}else t.reply("TEXT","Define volume [0-100]");"switch"==s[0]&&(t.reply("TEXT","Switch Database (USB Key/Local Folder)"),this.MusicCommand("SWITCH"))}else t.reply("TEXT","Need Help for /music commands ?\n\n  *play*: Launch music (last title)\n  *pause*: Pause music\n  *stop*: Stop music\n  *next*: Next track\n  *previous*: Previous track\n  *rebuild*: Rebuild music Database\n  *volume*: Volume control, it need a value 0-100\n  *switch*: Switch between USB Key and Local Folder\n  ",{parse_mode:"Markdown"})},EXTActionsOnStatus:function(e){switch(this.EXT=this.displayEXTResponse.EXT,e){case"listen":case"think":this.config.Extented.screen.useScreen&&!this.EXT.locked&&this.sendSocketNotification("SCREEN_STOP"),this.EXT.locked&&this.displayEXTResponse.hideDisplay(),this.config.Extented.youtube.useYoutube&&this.config.Extented.youtube.useVLC&&this.sendSocketNotification("YT_VOLUME",this.config.Extented.youtube.minVolume),this.config.Extented.spotify.useSpotify&&this.EXT.spotify.player&&(this.EXT.spotify.targetVolume=this.EXT.spotify.currentVolume,this.sendSocketNotification("SPOTIFY_VOLUME",this.config.Extented.spotify.player.minVolume)),this.config.Extented.music.useMusic&&this.EXT.music.connected&&this.sendSocketNotification("MUSIC_VOLUME",this.config.Extented.music.minVolume),this.EXT.radioPlayer.play&&(this.displayEXTResponse.radio.volume=.1);break;case"hook":case"standby":this.config.Extented.screen.useScreen&&!this.EXT.locked&&this.sendSocketNotification("SCREEN_RESET"),this.config.Extented.youtube.useYoutube&&this.config.Extented.youtube.useVLC&&this.sendSocketNotification("YT_VOLUME",this.config.Extented.youtube.maxVolume),this.config.Extented.spotify.useSpotify&&this.EXT.spotify.player&&!this.EXT.spotify.forceVolume&&this.sendSocketNotification("SPOTIFY_VOLUME",this.EXT.spotify.targetVolume),this.config.Extented.music.useMusic&&this.EXT.music.connected&&this.sendSocketNotification("MUSIC_VOLUME",this.config.Extented.music.maxVolume),this.EXT.spotify.forceVolume=!1,this.EXT.radioPlayer.play&&(this.displayEXTResponse.radio.volume=.6);break;case"reply":this.displayEXTResponse.working()?this.displayEXTResponse.showDisplay():this.displayEXTResponse.hideDisplay()}},touchScreen:function(e){let t=0,s=null,i=document.getElementById("EXT_DISPLAY");switch(e){case 1:window.addEventListener("click",(()=>{t++,1===t?s=setTimeout((()=>{t=0,this.sendSocketNotification("SCREEN_WAKEUP")}),400):2===t&&(clearTimeout(s),t=0,this.sendSocketNotification("SCREEN_FORCE_END"))}),!1);break;case 2:i.addEventListener("click",(()=>{if(t)return t=0;this.hidden||this.sendSocketNotification("SCREEN_WAKEUP")}),!1),window.addEventListener("long-press",(()=>{t=1,this.hidden?this.sendSocketNotification("SCREEN_WAKEUP"):this.sendSocketNotification("SCREEN_FORCE_END"),s=setTimeout((()=>{t=0}),400)}),!1);break;case 3:i.addEventListener("click",(()=>{t++,1===t?s=setTimeout((()=>{t=0,this.sendSocketNotification("SCREEN_WAKEUP")}),400):2===t&&(clearTimeout(s),t=0,this.sendSocketNotification("SCREEN_FORCE_END"))}),!1),window.addEventListener("click",(()=>{this.hidden&&(t=3,this.sendSocketNotification("SCREEN_WAKEUP"),s=setTimeout((()=>{t=0}),400))}),!1)}e?logEXT("Touch Screen Function added. [mode "+e+"]"):logEXT("Touch Screen Function disabled.")},sendWelcome(){this.config.Extented.welcome.useWelcome&&this.config.Extented.welcome.welcome&&this.assistantActivate({type:"TEXT",key:this.config.Extented.welcome.welcome,chime:!1},Date.now())},checkStyle:function(){["Text","Line","SemiCircle","Circle"].find((e=>e==this.config.Extented.screen.displayStyle))||(console.log("[GA:EXT] displayStyle Error ! ["+this.config.Extented.screen.displayStyle+"]"),this.config.Extented.screen=Object.assign({},this.config.Extented.screen,{displayStyle:"Text"}))},initializeVolumeVLC:function(){try{let e=null;e=parseInt(this.config.Extented.youtube.minVolume),"number"==typeof e&&e>=0&&e<=100?this.config.Extented.youtube.minVolume=(255*e/100).toFixed(0):(console.error("[GA:EXT] config.youtube.minVolume error! Corrected with 30"),this.config.Extented.youtube.minVolume=70)}catch(e){console.error("[GA:EXT] config.youtube.minVolume error!",e),this.config.Extented.youtube.minVolume=70}try{let e=null;e=parseInt(this.config.Extented.youtube.maxVolume),"number"==typeof e&&e>=0&&e<=100?this.config.Extented.youtube.maxVolume=(255*e/100).toFixed(0):(console.error("[GA:EXT] config.youtube.maxVolume error! Corrected with 100"),this.config.Extented.youtube.maxVolume=255)}catch(e){console.error("[GA:EXT] config.youtube.maxVolume error!",e),this.config.Extented.youtube.maxVolume=255}console.log("[GA:EXT] YouTube -- VLC Volume Control initialized!")},initializeMusicVolumeVLC:function(){try{let e=null;e=parseInt(this.config.Extented.music.minVolume),"number"==typeof e&&e>=0&&e<=100?this.config.Extented.music.minVolume=(255*e/100).toFixed(0):(console.error("[GA:EXT] config.music.minVolume error! Corrected with 30"),this.config.Extented.music.minVolume=70)}catch(e){console.error("[GA:EXT] config.music.minVolume error!",e),this.config.Extented.music.minVolume=70}try{let e=null;e=parseInt(this.config.Extented.music.maxVolume),"number"==typeof e&&e>=0&&e<=100?this.config.Extented.music.maxVolume=(255*e/100).toFixed(0):(console.error("[GA:EXT] config.music.maxVolume error! Corrected with 100"),this.config.Extented.music.maxVolume=255)}catch(e){console.error("[GA:EXT] config.music.maxVolume error!",e),this.config.Extented.music.maxVolume=255}console.log("[GA:EXT] Music -- VLC Volume Control initialized!")},SpotifyCommand:function(e,t){if(this.config.Extented.spotify.useSpotify)switch(this.EXT=this.displayEXTResponse.EXT,e){case"PLAY":this.EXT.youtube.displayed&&this.EXT.spotify.player&&(this.EXT.radioPlayer.play&&this.displayEXTResponse.radio.pause(),this.config.Extented.youtube.useVLC?(this.sendSocketNotification("YT_STOP"),this.EXT.youtube.displayed=!1,this.displayEXTResponse.showYT(),this.displayEXTResponse.EXTUnlock(),this.displayEXTResponse.resetYT()):this.displayEXTResponse.player.command("stopVideo")),this.sendSocketNotification("SPOTIFY_PLAY");break;case"PAUSE":this.sendSocketNotification("SPOTIFY_PAUSE");break;case"STOP":this.EXT.spotify.player?this.sendSocketNotification("SPOTIFY_STOP"):this.sendSocketNotification("SPOTIFY_PAUSE");break;case"NEXT":this.sendSocketNotification("SPOTIFY_NEXT");break;case"PREVIOUS":this.sendSocketNotification("SPOTIFY_PREVIOUS");break;case"SHUFFLE":this.sendSocketNotification("SPOTIFY_SHUFFLE",!this.EXT.spotify.shuffle);break;case"REPEAT":this.sendSocketNotification("SPOTIFY_REPEAT","off"==this.EXT.spotify.repeat?"track":"off");break;case"TRANSFER":this.sendSocketNotification("SPOTIFY_TRANSFER",t);break;case"VOLUME":this.EXT.spotify.forceVolume=!0,this.sendSocketNotification("SPOTIFY_VOLUME",t);break;case"SEARCH":var s=t.query.split(" "),i=null;s[0]==this.translate("SpotifySearchTypePlaylist")?i="playlist":s[0]==this.translate("SpotifySearchTypeAlbum")?i="album":s[0]==this.translate("SpotifySearchTypeTrack")?i="track":s[0]==this.translate("SpotifySearchTypeArtist")&&(i="artist"),i&&(t.query=t.query.replace(s[0]+" ",""),t.type=i);var o={query:{q:t.query,type:t.type},condition:{random:t.random,autoplay:!0}};this.sendSocketNotification("SEARCH_AND_PLAY",o),this.EXT.youtube.displayed&&this.EXT.spotify.player&&(this.config.Extented.youtube.useVLC?(this.sendSocketNotification("YT_STOP"),this.EXT.youtube.displayed=!1,this.displayEXTResponse.showYT(),this.displayEXTResponse.EXTUnlock(),this.displayEXTResponse.resetYT()):this.displayEXTResponse.player.command("stopVideo"))}},MusicCommand:function(e,t,s){if(this.config.Extented.music.useMusic)switch(this.EXT=this.displayEXTResponse.EXT,e){case"PLAY":this.EXT.radioPlayer.play&&this.displayEXTResponse.radio.pause(),this.EXT.youtube.displayed&&(this.config.Extented.youtube.useVLC?(this.sendSocketNotification("YT_STOP"),this.EXT.youtube.displayed=!1,this.displayEXTResponse.showYT(),this.displayEXTResponse.EXTUnlock(),this.displayEXTResponse.resetYT()):this.displayEXTResponse.player.command("stopVideo")),this.config.Extented.spotify.useSpotify&&this.EXT.spotify.player&&this.sendSocketNotification("SPOTIFY_STOP"),this.sendSocketNotification("MUSIC_PLAY");break;case"PAUSE":this.sendSocketNotification("MUSIC_PAUSE");break;case"STOP":this.sendSocketNotification("MUSIC_STOP");break;case"NEXT":this.sendSocketNotification("MUSIC_NEXT");break;case"PREVIOUS":this.sendSocketNotification("MUSIC_PREVIOUS");break;case"VOLUME":if(!s){var i=t;if(isNaN(i))return console.log("ERROR MUSIC VOLUME","Must be a number ! [0-100]",i);t>100&&(i=100),t<0&&(i=0),i=parseInt((256*i/100).toFixed(0))}this.config.Extented.music.maxVolume=s?t:i,this.sendSocketNotification("MUSIC_VOLUME_TARGET",s?t:i);break;case"REBUILD":this.sendSocketNotification("MUSIC_REBUILD");break;case"SWITCH":this.sendSocketNotification("MUSIC_SWITCH")}},stopCommand:function(){this.EXT=this.displayEXTResponse.EXT,this.EXT.locked&&(this.EXT.youtube.displayed&&(this.config.Extented.youtube.useVLC?(this.sendSocketNotification("YT_STOP"),this.EXT.youtube.displayed=!1,this.displayEXTResponse.showYT(),this.displayEXTResponse.EXTUnlock(),this.displayEXTResponse.resetYT()):this.displayEXTResponse.YTStopAPI()),this.EXT.photos.displayed&&(this.displayEXTResponse.resetPhotos(),this.displayEXTResponse.hideDisplay()),this.EXT.links.displayed&&(this.displayEXTResponse.resetLinks(),this.displayEXTResponse.hideDisplay())),this.EXT.spotify.player&&(this.config.Extented.spotify.player.usePause?this.sendSocketNotification("SPOTIFY_PAUSE"):this.sendSocketNotification("SPOTIFY_STOP")),this.EXT.radioPlayer.play&&this.displayEXTResponse.radio.pause(),this.EXT.music.connected&&this.sendSocketNotification("MUSIC_STOP"),this.sendNotification("TV-STOP"),this.Informations("information",{message:"EXTStop"})},radioCommand:function(e){if(this.EXT=this.displayEXTResponse.EXT,this.EXT.spotify.player&&this.sendSocketNotification("SPOTIFY_STOP"),this.EXT.music.connected&&this.sendSocketNotification("MUSIC_STOP"),this.EXT.youtube.displayed&&(this.config.Extented.youtube.useVLC?(this.sendSocketNotification("YT_STOP"),this.EXT.youtube.displayed=!1,this.displayEXTResponse.showYT(),this.displayEXTResponse.EXTUnlock(),this.displayEXTResponse.resetYT()):this.displayEXTResponse.player.command("stopVideo")),e.link){if(e.img){var t=document.getElementById("EXT_RADIO_IMG"),s=document.getElementById("EXT_RADIO_BACKGROUND");this.EXT.radioPlayer.img=e.img,t.src=this.EXT.radioPlayer.img,s.style.backgroundImage=`url(${e.img})`}this.displayEXTResponse.radio.src=e.link,this.displayEXTResponse.radio.autoplay=!0}},showGooglePhotos(){return this.config.Extented.photos.usePhotos?this.config.Extented.photos.useGooglePhotosAPI?"Background"==this.config.Extented.photos.displayType?this.Informations("warning",{message:"GPhotosBckGrndActivated"}):"Module"==this.config.Extented.photos.displayType?this.Informations("warning",{message:"GPhotosModuleActivated"}):"Recipe"!=this.config.Extented.photos.displayType?this.Informations("warning",{message:"GPhotosRecipeNotActivated"}):void this.displayEXTResponse.showGooglePhotoAPI():this.Informations("warning",{message:"GPhotosNotActivated"}):this.Informations("warning",{message:"PhotosNotActivated"})},dateDiff:function(e,t){var s={},i=t-e;return i=Math.floor(i/1e3),s.sec=i%60,i=Math.floor((i-s.sec)/60),s.min=i%60,i=Math.floor((i-s.min)/60),s.hour=i%24,i=Math.floor((i-s.hour)/24),s.day=i,s},Informations(e,t){if(-1==["warning","information"].indexOf(e))return logGA("debug information:",e,t),this.Informations("warning",{message:"Core Information: Display Type Error!"});if(!t.message)return logGA("debug information:",t),this.Informations("warning",{message:"Core Information: no message!"});let s={type:e,info:t};this.Infos.buffer.push(s),logGA("Informations Buffer Add:",this.Infos),this.InformationsBuffer(this.Infos.buffer[0].type,this.Infos.buffer[0].info)},InformationsBuffer:function(e,t){!this.Infos.displayed&&this.Infos.buffer.length&&(logGA(e+":",t),"warning"==e&&this.config.responseConfig.useChime&&(this.assistantResponse.infoWarning.src=this.assistantResponse.resourcesDir+this.assistantResponse.chime.warning),("information"!=e||this.config.responseConfig.useInformations)&&(this.logoInformations(e),this.showInformations(t),this.InformationShow(),this.warningTimeout=setTimeout((()=>{this.InformationHidden()}),this.config.responseConfig.screenOutputTimer)))},showInformations:function(e){document.getElementById("Infos-Transcription").textContent=this.translate(e.message,{VALUES:e.values})},logoInformations:function(e){document.getElementById("Infos-Icon").src=this.assistantResponse.imgStatus[e]},InformationHidden:function(){this.assistantResponse.infosDiv.classList.remove("animate__bounceInDown"),this.assistantResponse.infosDiv.classList.add("animate__bounceOutUp"),this.assistantResponse.infosDiv.addEventListener("animationend",(e=>{"bounceOutUp"==e.animationName&&"Infos"==e.path[0].id&&Infos.classList.add("hidden"),this.showInformations(""),this.Infos.buffer.shift(),this.Infos.displayed=!1,logGA("Informations Buffer deleted",this.Infos),this.Infos.buffer.length&&this.InformationsBuffer(this.Infos.buffer[0].type,this.Infos.buffer[0].info)}),{once:!0})},InformationShow:function(){this.Infos.displayed=!0,this.assistantResponse.infosDiv.classList.remove("hidden","animate__bounceOutUp"),this.assistantResponse.infosDiv.classList.add("animate__bounceInDown")},Loading:function(){this.assistantResponse.forceStatusImg("standby"),this.assistantResponse.showTranscription(this.translate("GALoading")+" MMM-GoogleAssistant"),this.assistantResponse.fullscreen(!0,null,!1)},Version(e){this.assistantResponse.showTranscription("MMM-GoogleAssistant v"+e.version+" ("+e.rev+") Â©bugsounet "+this.translate("GAReady")),this.assistantResponse.fullscreen(!0,null,!1),this.aliveTimer=setTimeout((()=>{this.assistantResponse.end(!1),this.assistantResponse.showTranscription("")}),this.config.responseConfig.screenOutputTimer)},resume:function(){(this.config.Extented.spotify.useSpotify&&(this.EXT=this.displayEXTResponse.EXT,this.EXT.spotify.connected&&this.config.Extented.spotify.visual.useBottomBar&&(this.displayEXTResponse.showSpotify(),logEXT("Spotify is resumed."))),this.config.Extented.photos.usePhotos&&"Background"==this.config.Extented.photos.displayType&&this.config.Extented.photos.useGooglePhotosAPI)&&(document.getElementById("EXT_GPHOTO").classList.remove("hidden"),logEXT("GPhotos is resumed."))},suspend:function(){(this.config.Extented.spotify.useSpotify&&(this.EXT=this.displayEXTResponse.EXT,this.EXT.spotify.connected&&this.config.Extented.spotify.visual.useBottomBar&&(this.displayEXTResponse.hideSpotify(),logEXT("Spotify is suspended."))),this.config.Extented.photos.usePhotos&&"Background"==this.config.Extented.photos.displayType&&this.config.Extented.photos.useGooglePhotosAPI)&&(document.getElementById("EXT_GPHOTO").classList.add("hidden"),logEXT("GPhotos is suspended."))}});